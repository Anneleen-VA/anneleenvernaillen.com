<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>

  <!-- Include the script that enables Netlify Identity on this page. -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  <script>

    var NewsPreview=createClass({
      render: function() {
        var entry=this.props.entry;
        var thumbnail=entry.getIn(['data','thumbnail']);
        var bg=this.props.getAsset(thumbnail);
        return h('div',{},
          h('h1',{},entry.getIn(['data','title'])),
          h('span', {}, 'Thumbnail:'),
          h('br'),
          h('img',{src: bg.toString(), class: 'newsThumbnail'}),
          h('span',{},'Content:'),
          h('hr'),
          h('div',{"className": "prose"},this.props.widgetFor('body'))
        );
      }
    });
    CMS.registerPreviewTemplate("news",NewsPreview);


    CMS.registerEditorComponent({
      // Internal id of the component
      id: "Columns",
      // Visible label
      label: "Columns",
      // Fields the user need to fill out when adding an instance of the component
      fields: [
        {
          name: 'colLeft',
          label: 'Left Column',
          widget: 'markdown'
        },
        {
          name: 'colRight',
          label: 'Right Column',
          widget: 'markdown'
        }
      ],
      // Regex pattern used to search for instances of this block in the markdown document.
      // Patterns are run in a multline environment (against the entire markdown document),
      // and so generally should make use of the multiline flag (`m`). If you need to capture
      // newlines in your capturing groups, you can either use something like
      // `([\S\s]*)`, or you can additionally enable the "dot all" flag (`s`),
      // which will cause `(.*)` to match newlines as well.
      //
      // Additionally, it's recommended that you use non-greedy capturing groups (e.g.
      // `(.*?)` vs `(.*)`), especially if matching against newline characters.
      pattern: /^<div class=\"col-left\">\n\n(.*)\n<\/div>\n<div class=\"col-right\">\n\n(.*)\n<\/div>\n<div class=\"col-clear\"><\/div>$/ms,
      // Given a RegExp Match object
      // (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match#return_value),
      // return an object with one property for each field defined in `fields`.
      //
      // This is used to populate the custom widget in the markdown editor in the CMS.
      fromBlock: function(match) {
        return {
          colLeft: match[1],
          colRight: match[2]
        };
      },
      // Given an object with one property for each field defined in `fields`,
      // return the string you wish to be inserted into your markdown.
      //
      // This is used to serialize the data from the custom widget to the
      // markdown document
      toBlock: function(data) {
        return `
<div class="col-left">

${data.colLeft}
</div>
<div class="col-right">

${data.colRight}
</div>
<div class="col-clear"></div>`;
      },
      // Preview output for this component. Can either be a string or a React component
      // (component gives better render performance)
      toPreview: function(data) {
        return `
<div class="col-left">

${data.colLeft}
</div>
<div class="col-right">

${data.colRight}
</div>
<div class="col-clear"></div>`;
      }
    });
    CMS.registerPreviewStyle('/css/tailwind.css');
    CMS.registerPreviewStyle('/css/markdown.css');
    CMS.registerPreviewStyle('/css/prose.css');
    CMS.registerPreviewStyle('/css/admin.css');
  </script>
</body>

</html>
